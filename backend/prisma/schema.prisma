// Jeevaloom â€” Prisma Schema
// SQLite for local dev

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  name         String   @default("User")
  role         String   @default("patient")
  language     String   @default("en")
  phoneNumber  String?  @unique @map("phone_number")
  createdAt    DateTime @default(now()) @map("created_at")

  healthProfile       HealthProfile?
  ayurvedaAssessments AyurvedaAssessment[]
  healthAssessments   HealthAssessment[]
  prescriptions       Prescription[]
  healthAlerts        HealthAlert[]
  emergencyAccess     EmergencyAccess?
  medications         Medication[]
  emergencyContacts   EmergencyContact[]
  medicalReports      MedicalReport[]
  caretakersAsPatient Caretaker[] @relation("PatientCaretakers")
  caretakersAsCaretaker Caretaker[] @relation("CaretakerPatients")

  @@map("users")
}

model HealthProfile {
  id                String   @id @default(uuid())
  userId            String   @unique @map("user_id")
  fullName          String   @map("full_name")
  dob               String?
  gender            String?
  bloodGroup        String?  @map("blood_group")
  heightCm          Float?   @map("height_cm")
  weightKg          Float?   @map("weight_kg")
  allergies         String   @default("[]")
  chronicConditions String   @default("[]") @map("chronic_conditions")
  primaryDosha      String?  @map("primary_dosha")
  doshaVata         Float?   @map("dosha_vata")
  doshaPitta        Float?   @map("dosha_pitta")
  doshaKapha        Float?   @map("dosha_kapha")
  createdAt         DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("health_profiles")
}

model AyurvedaAssessment {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  answers   String
  result    String
  vataScore Int      @default(0) @map("vata_score")
  pittaScore Int     @default(0) @map("pitta_score")
  kaphaScore Int     @default(0) @map("kapha_score")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ayurveda_assessments")
}

model HealthAssessment {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  answers      String
  bmi          Float?
  riskScore    Int?     @map("risk_score")
  riskLevel    String?  @map("risk_level")
  createdAt    DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("health_assessments")
}

model Prescription {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  type      String
  fileName  String   @map("file_name")
  fileUrl   String   @map("file_url")
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("prescriptions")
}

model Medication {
  id                String   @id @default(uuid())
  userId            String   @map("user_id")
  medicineName      String   @map("medicine_name")
  medicineSystem    String   @default("allopathy") @map("medicine_system")
  medicineForm      String   @default("tablet") @map("medicine_form")
  dosage            String?
  dosageUnit        String?  @map("dosage_unit")
  frequency         String?
  timing            String   @default("[]")
  startDate         String?  @map("start_date")
  endDate           String?  @map("end_date")
  prescribedBy      String?  @map("prescribed_by")
  hospitalClinic    String?  @map("hospital_clinic")
  purpose           String?
  quantityRemaining Int?     @map("quantity_remaining")
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("medications")
}

model MedicalReport {
  id                   String   @id @default(uuid())
  userId               String   @map("user_id")
  reportName           String   @map("report_name")
  reportType           String   @default("general") @map("report_type")
  fileUrl              String?  @map("file_url")
  reportDate           String?  @map("report_date")
  hospitalLab          String?  @map("hospital_lab")
  doctorName           String?  @map("doctor_name")
  autoGeneratedSummary String?  @map("auto_generated_summary")
  isCritical           Boolean  @default(false) @map("is_critical")
  createdAt            DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("medical_reports")
}

model EmergencyContact {
  id           String  @id @default(uuid())
  userId       String  @map("user_id")
  name         String
  relation     String?
  phoneNumbers String  @default("[]") @map("phone_numbers")
  emails       String  @default("[]")
  isPrimary    Boolean @default(false) @map("is_primary")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("emergency_contacts")
}

model Caretaker {
  id                 String   @id @default(uuid())
  patientId          String   @map("patient_id")
  caretakerId        String   @map("caretaker_id")
  relationship       String?
  status             String   @default("pending")
  canEditMedications Boolean  @default(false) @map("can_edit_medications")
  canUploadReports   Boolean  @default(false) @map("can_upload_reports")
  canEditProfile     Boolean  @default(false) @map("can_edit_profile")
  acceptedAt         DateTime? @map("accepted_at")
  createdAt          DateTime @default(now()) @map("created_at")

  patient   User @relation("PatientCaretakers", fields: [patientId], references: [id], onDelete: Cascade)
  caretaker User @relation("CaretakerPatients", fields: [caretakerId], references: [id], onDelete: Cascade)

  @@map("caretakers")
}

model HealthAlert {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  alertType   String   @map("alert_type")
  severity    String   @default("info")
  title       String
  message     String
  isRead      Boolean  @default(false) @map("is_read")
  isDismissed Boolean  @default(false) @map("is_dismissed")
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("health_alerts")
}

model EmergencyAccess {
  id                    String    @id @default(uuid())
  userId                String    @unique @map("user_id")
  accessToken           String    @unique @map("access_token")
  isActive              Boolean   @default(true) @map("is_active")
  accessCount           Int       @default(0) @map("access_count")
  lastAccessed          DateTime? @map("last_accessed")
  showBloodGroup        Boolean   @default(true) @map("show_blood_group")
  showAllergies         Boolean   @default(true) @map("show_allergies")
  showChronicConditions Boolean   @default(true) @map("show_chronic_conditions")
  showMedications       Boolean   @default(true) @map("show_medications")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("emergency_access")
}
